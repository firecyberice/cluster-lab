#!/bin/bash

# include common helper functions
. /usr/local/lib/cluster-lab/common

# include cluster-lab config
. /etc/cluster-lab/cluster.conf

# include cluster-lab functions
for sourcefile in /usr/local/lib/cluster-lab/*.lib; do 
  . $sourcefile
done

usage () {
cat << EOM
usage:
        $0 start            Start the cluster lab.

        $0 stop             Stop the cluster lab.

EOM
}

function exit_with_message_on_error(){
  if [[ ${1} -gt 0 ]]; then
    echo "${2}"
    exit 1
  fi 
}

function start(){
  pre_check_networking
  exit_with_message_on_error $? "Networking is broken"

  configure_networking

  post_check_networking
  exit_with_message_on_error $? "Networking  broken"
}

function stop(){
  reset_networking
  pre_check_networking
}

if [ $# -eq 1 ]; then
    case "$1" in
        "start" )
            start
            ;;
        "stop" )
            stop
            ;;
        * )
        if [[ $DEBUG == "true" ]]; then
            "$@"
        else
            usage
        fi
            ;;
    esac
else
    usage
fi
