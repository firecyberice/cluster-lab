###############################################
#     config file for HyprIoT Cluster Lab     #
#                                             #
#  This file gets sourced in the              #
#  hypriot-cluster.service                    #
#                                             #
###############################################

DOCKER_COMPOSE_PROJECT="hypriot"

VLAN_ID="200"


NETMASK="/24"

VLAN_MASTER_IP="192.168.200.1"
VLAN_LEADER_IP="192.168.200.1"

VLAN_TEST_IP="192.168.200.5"

DHCP_BROADCAST="192.168.200.255"
DHCP_NETMASK="255.255.255.0"
DHCP_RANGE_FROM="192.168.200.20"
DHCP_RANGE_TO="192.168.200.50"

#############################
ARCHITECTURE=$(uname -m)
VLAN_INTERFACE="eth0.${VLAN_ID}"
VLAN_SUBNET=$(echo "${VLAN_LEADER_IP}" | cut -d'.' -f1-3)


# Variables that use some helper functions
VLAN_NODE_IP="$(ip_of_interface "${VLAN_INTERFACE}")"
ESCAPED_VLAN_NODE_IP=$(escape_ip_for_regex "${VLAN_NODE_IP}")


# These OPTS are added to the already existing ones:
# We already added:
DOCKER_OPTS='--storage-driver=overlay -D -H tcp://${SELFIP}:2375 \
--cluster-advertise ${SELFIP}:2375 --cluster-store consul://${SELFIP}:8500 \
--label hypriot.arch=${ARCHITECTURE} --label hypriot.hierarchy=${MASTERorSLAVE}'


# choose the correct docker image for the current architecture
case "$ARCHITECTURE" in
    arm*)
        IMAGE_SWARM=hypriot/rpi-swarm:1.1.0
        IMAGE_CONSUL=hypriot/rpi-consul:0.6.0
        ;;
    amd64|x86_64)
        IMAGE_SWARM=swarm:1.1.0
        IMAGE_CONSUL=gliderlabs/consul:0.6
        ;;
    * )
        echo "Your architecture is not supported."
        ;;
esac
